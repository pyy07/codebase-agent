# Design: Remotion 推广视频集成

## Context

项目需要制作一个专业的推广视频来展示 Codebase Driven Agent 的核心价值。选择使用 Remotion 框架，因为它基于 React，与项目前端技术栈一致，且支持代码驱动的视频制作方式。

## Goals / Non-Goals

### Goals
- 创建一个可维护、可迭代的视频制作系统
- 视频内容能够清晰展示项目的核心功能和价值
- 视频质量达到专业水准，适合在多个平台分享
- 视频制作流程简单，便于后续更新和修改

### Non-Goals
- 不替换现有的 Web UI 应用（视频项目独立存在）
- 不强制要求视频内容（允许灵活调整）
- 不实现复杂的视频编辑功能（专注于推广视频制作）

## Decisions

### Decision 1: 项目结构组织

**选择**：在 `web/` 目录下创建独立的 `src/video/` 目录，与主应用代码分离。

**理由**：
- 保持代码组织清晰，视频代码不影响主应用
- 便于独立开发和维护
- 可以单独构建和部署视频项目

**替代方案**：
- 创建完全独立的 `video/` 目录：增加了项目根目录复杂度
- 集成到主应用：可能影响主应用构建性能

### Decision 2: Remotion 配置方式

**选择**：使用独立的 `remotion.config.ts` 配置文件，与 Vite 配置分离。

**理由**：
- Remotion 有独立的配置需求
- 避免与主应用的 Vite 配置冲突
- 更清晰的职责分离

**替代方案**：
- 集成到 `vite.config.ts`：可能导致配置复杂化

### Decision 3: 视频场景组织

**选择**：每个场景作为独立的 React 组件，通过组合方式组织。

**理由**：
- 符合 React 组件化思想
- 便于复用和维护
- 易于测试和调试

**替代方案**：
- 单一大型组件：难以维护和复用

### Decision 4: 视频导出格式

**选择**：主要支持 MP4 格式（H.264 编码），可选 WebM。

**理由**：
- MP4 兼容性最好，支持所有主流平台
- H.264 编码质量好且文件大小适中
- WebM 作为备选格式支持现代浏览器

**替代方案**：
- 仅支持 WebM：兼容性较差
- 支持多种格式：增加构建复杂度

### Decision 5: 视频分辨率

**选择**：默认 1920x1080 (Full HD)，支持自定义分辨率。

**理由**：
- Full HD 是当前主流分辨率
- 文件大小和质量平衡良好
- 可以轻松缩放到其他分辨率

**替代方案**：
- 4K：文件过大，不适合网络分享
- 720p：质量可能不够专业

## Risks / Trade-offs

### Risk 1: 构建时间增加
**风险**：Remotion 视频渲染可能需要较长时间
**缓解**：使用 Remotion Studio 进行快速预览，仅在最终导出时进行完整渲染

### Risk 2: 依赖增加
**风险**：Remotion 及其依赖会增加项目体积
**缓解**：视频项目独立，不影响主应用打包体积；仅在开发视频时需要这些依赖

### Risk 3: 学习曲线
**风险**：团队需要学习 Remotion API
**缓解**：Remotion 基于 React，学习成本较低；提供详细文档和示例

### Risk 4: 视频内容维护
**风险**：视频内容可能需要频繁更新
**缓解**：代码驱动的视频制作方式便于版本控制和迭代

## Migration Plan

### Phase 1: 初始设置（不影响现有功能）
1. 安装 Remotion 依赖
2. 创建视频项目目录结构
3. 配置 Remotion 开发环境

### Phase 2: 视频制作（独立开发）
1. 创建基础组件和场景
2. 实现视频内容
3. 测试和优化

### Phase 3: 集成和文档（可选）
1. 将视频集成到项目文档
2. 更新 README 和文档
3. 提供使用指南

**回滚计划**：如果出现问题，可以删除 `src/video/` 目录和相关配置，不影响主应用功能。

## Open Questions

1. **视频时长**：需要确定最佳视频时长（建议 30-60 秒）
2. **视频风格**：需要确定视频风格（技术感、简洁、动画等）
3. **多语言支持**：是否需要支持多语言版本的视频
4. **视频更新频率**：确定视频内容的更新策略和频率

## Technical Details

### 目录结构
```
web/
├── src/
│   ├── video/              # 视频项目代码
│   │   ├── scenes/         # 视频场景组件
│   │   ├── components/     # 可复用组件
│   │   ├── assets/         # 视频资源（图片、字体等）
│   │   ├── Root.tsx        # Remotion 根组件
│   │   └── index.ts        # 入口文件
│   └── ...                 # 主应用代码（不变）
├── remotion.config.ts      # Remotion 配置
└── package.json            # 添加视频相关脚本
```

### 关键依赖
- `remotion` - Remotion 核心库
- `@remotion/bundler` - 视频打包工具
- `@remotion/cli` - 命令行工具
- `@remotion/lottie` - Lottie 动画支持（可选）
- `@remotion/three` - Three.js 3D 支持（可选）

### 构建脚本
```json
{
  "scripts": {
    "video:dev": "remotion studio",
    "video:render": "remotion render",
    "video:preview": "remotion preview"
  }
}
```
