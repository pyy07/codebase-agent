# Codebase Driven Agent

åŸºäºä»£ç ä»“åº“é©±åŠ¨çš„é€šç”¨ AI Agent å¹³å°ï¼Œé€šè¿‡æŸ¥é˜…ä»£ç ã€æ—¥å¿—ã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æºï¼Œä¸ºå¼€å‘è€…æä¾›æ™ºèƒ½åŒ–çš„ä»£ç åˆ†æå’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚

## é¡¹ç›®æ„¿æ™¯

**Codebase Driven Agent** æ˜¯ä¸€ä¸ªåŸºäºä»£ç åº“é©±åŠ¨çš„é€šç”¨ AI Agent å¹³å°ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªèƒ½å¤Ÿæ·±åº¦ç†è§£ä»£ç åº“ã€è‡ªä¸»è°ƒç”¨å¤šç§å·¥å…·ã€è§£å†³å„ç±»å¼€å‘é—®é¢˜çš„æ™ºèƒ½åŠ©æ‰‹ã€‚

**é—®é¢˜åˆ†æå’Œé”™è¯¯æ’æŸ¥** åªæ˜¯æˆ‘ä»¬å½“å‰çš„åˆ‡å…¥ç‚¹ï¼Œæœªæ¥å°†æ‰©å±•åˆ°æ›´å¤šåœºæ™¯ï¼š
- ğŸ” ä»£ç ç†è§£å’Œæ–‡æ¡£ç”Ÿæˆ
- ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå’Œä¼˜åŒ–
- ğŸ”§ ä»£ç é‡æ„å»ºè®®
- ğŸ“Š ä»£ç è´¨é‡åˆ†æ
- ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®
- ğŸ“ API æ–‡æ¡£ç”Ÿæˆ
- ä»¥åŠå…¶ä»–åŸºäºä»£ç åº“çš„æ™ºèƒ½åŒ–åŠŸèƒ½

## å½“å‰åŠŸèƒ½ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰

å½“å‰ç‰ˆæœ¬ä¸“æ³¨äº**é—®é¢˜åˆ†æå’Œé”™è¯¯æ’æŸ¥**åŠŸèƒ½ï¼š

- ğŸ¤– **æ™ºèƒ½åˆ†æ**: åŸºäº LangGraph Agent æ¡†æ¶ï¼Œè‡ªä¸»è°ƒç”¨å·¥å…·åˆ†æé—®é¢˜
- ğŸ’¬ **äº¤äº’å¼åˆ†æ**: Agent å¯ä»¥åœ¨åˆ†æè¿‡ç¨‹ä¸­ä¸»åŠ¨è¯·æ±‚ç”¨æˆ·æä¾›é¢å¤–ä¿¡æ¯ï¼Œæ”¯æŒå¤šè½®äº¤äº’
- ğŸ“š **å¤šæ•°æ®æº**: æ”¯æŒä»£ç ä»“åº“ã€æ—¥å¿—ç³»ç»Ÿï¼ˆæ—¥å¿—æ˜“ï¼‰ã€æ•°æ®åº“æŸ¥è¯¢
- ğŸ” **ä»£ç æ£€ç´¢**: åŸºäºé”™è¯¯ä¿¡æ¯æ™ºèƒ½æ£€ç´¢ç›¸å…³ä»£ç 
- ğŸ“‹ **æ—¥å¿—åˆ†æ**: æ”¯æŒæ—¥å¿—æ˜“ SPL æŸ¥è¯¢å’Œæœ¬åœ°æ–‡ä»¶æ—¥å¿—æŸ¥è¯¢
- ğŸ—„ï¸ **æ•°æ®åº“æŸ¥è¯¢**: æ”¯æŒ MySQLã€PostgreSQL ç­‰æ•°æ®åº“
- ğŸ› ï¸ **å†…ç½®å·¥å…·é›†**: æä¾›æ–‡ä»¶è¯»å–ã€æ–‡ä»¶åŒ¹é…ã€å†…å®¹æœç´¢ã€å‘½ä»¤æ‰§è¡Œã€ç½‘é¡µè·å–ç­‰å®ç”¨å·¥å…·
- ğŸŒ **REST API**: æä¾›åŒæ­¥ã€å¼‚æ­¥ã€æµå¼ï¼ˆSSEï¼‰ä¸‰ç§æ¥å£
- ğŸ’» **Web UI**: æä¾›å‹å¥½çš„èŠå¤©å¼ç”¨æˆ·ç•Œé¢ï¼ˆReact + TypeScriptï¼‰ï¼Œæ”¯æŒå®æ—¶æ­¥éª¤å±•ç¤ºå’Œäº¤äº’å¼å¯¹è¯æ¡†

## æ ¸å¿ƒèƒ½åŠ›

- ğŸ—ï¸ **ä»£ç åº“é©±åŠ¨**: æ·±åº¦ç†è§£ä»£ç åº“ç»“æ„å’Œé€»è¾‘ï¼ŒåŸºäºä»£ç ä¸Šä¸‹æ–‡è¿›è¡Œæ™ºèƒ½åˆ†æ
- ğŸ”Œ **å·¥å…·åŒ–æ¶æ„**: å¯æ‰©å±•çš„å·¥å…·ç³»ç»Ÿï¼Œæ”¯æŒä»£ç ã€æ—¥å¿—ã€æ•°æ®åº“ç­‰å¤šç§æ•°æ®æº
- ğŸ§  **è‡ªä¸»å†³ç­–**: Agent èƒ½å¤Ÿè‡ªä¸»é€‰æ‹©å·¥å…·ã€åˆ†æç»“æœã€ç”Ÿæˆè§£å†³æ–¹æ¡ˆ
- ğŸ’¬ **äº¤äº’å¼åä½œ**: Agent èƒ½å¤Ÿè¯†åˆ«ä¿¡æ¯ä¸è¶³çš„æƒ…å†µï¼Œä¸»åŠ¨è¯·æ±‚ç”¨æˆ·è¾“å…¥ï¼Œå®ç°äººæœºåä½œåˆ†æ
- ğŸ”„ **æŒç»­æ‰©å±•**: æ¶æ„è®¾è®¡æ”¯æŒæœªæ¥æ·»åŠ æ–°çš„å·¥å…·å’ŒåŠŸèƒ½åœºæ™¯

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install -e ".[dev]"
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# LLM é…ç½®ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
OPENAI_API_KEY=your-openai-api-key
# æˆ–ä½¿ç”¨è‡ªå®šä¹‰ Base URLï¼ˆæ”¯æŒå…¶ä»– OpenAI å…¼å®¹çš„ APIï¼‰
OPENAI_BASE_URL=https://your-custom-api-endpoint.com/v1
OPENAI_API_KEY=your-api-key

# æˆ–ä½¿ç”¨é€šç”¨é…ç½®ï¼ˆå…¶ä»–ä¾›åº”å•†ï¼‰
# LLM_BASE_URL=https://your-custom-api-endpoint.com/v1
# LLM_API_KEY=your-api-key

# æˆ–
ANTHROPIC_API_KEY=your-anthropic-api-key

# æ—¥å¿—æ˜“é…ç½®ï¼ˆå¯é€‰ï¼‰
LOGYI_BASE_URL=https://your-logyi-instance.com
LOGYI_USERNAME=your-username
LOGYI_APIKEY=your-api-key
# LOGYI_APPNAME å¯ä»¥ä¸é…ç½®ï¼ŒAgent ä¼šåœ¨éœ€è¦æ—¶è¯¢é—®ç”¨æˆ·
# LOGYI_APPNAME=your-project-name

# ä»£ç ä»“åº“é…ç½®ï¼ˆå¯é€‰ï¼‰
# Windows ç¤ºä¾‹ï¼ˆæ¨èä½¿ç”¨æ­£æ–œæ ï¼‰:
CODE_REPO_PATH=your-code-repo-path
# Linux/Mac ç¤ºä¾‹:
# CODE_REPO_PATH=/home/user/codebase

# æ•°æ®åº“é…ç½®ï¼ˆå¯é€‰ï¼‰
DATABASE_URL=mysql+pymysql://user:password@localhost:3306/dbname

# API é…ç½®
API_KEY=your-api-key-for-authentication
```

### è¿è¡ŒæœåŠ¡

#### æ–¹å¼ 1: Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™å¿…è¦çš„é…ç½®

# 2. ä¸€é”®å¯åŠ¨
chmod +x scripts/start.sh
./scripts/start.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
docker-compose up -d
```

è®¿é—® http://localhost:8000/docs æŸ¥çœ‹ API æ–‡æ¡£ã€‚

è¯¦ç»†éƒ¨ç½²è¯´æ˜è¯·æŸ¥çœ‹ [DEPLOYMENT.md](DEPLOYMENT.md)

#### æ–¹å¼ 2: æœ¬åœ°è¿è¡Œ

```bash
uvicorn codebase_driven_agent.main:app --reload
```

åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:8000

è®¿é—® http://localhost:8000/docs æŸ¥çœ‹ Swagger API æ–‡æ¡£ã€‚

### å¯åŠ¨ Web UI

1. **è¿›å…¥ Web ç›®å½•**

```bash
cd web
```

2. **å®‰è£…å‰ç«¯ä¾èµ–**

```bash
npm install
```

3. **å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ **http://localhost:3000**

4. **è®¿é—® Web UI**

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:3000**

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [Web UI å¯åŠ¨æŒ‡å—](docs/WEB_UI.md)

## é¡¹ç›®ç»“æ„

```
codebase_driven_agent/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”œâ”€â”€ agent/               # Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ graph_executor.py    # LangGraph æ‰§è¡Œå™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ callbacks.py         # LangChain å›è°ƒ
â”‚   â”œâ”€â”€ input_parser.py      # è¾“å…¥è§£æå™¨
â”‚   â”œâ”€â”€ output_parser.py     # è¾“å‡ºè§£æå™¨
â”‚   â”œâ”€â”€ memory.py            # è®°å¿†ç®¡ç†
â”‚   â”œâ”€â”€ prompt.py            # Prompt æ¨¡æ¿
â”‚   â”œâ”€â”€ session_manager.py   # ä¼šè¯ç®¡ç†ï¼ˆç”¨æˆ·äº¤äº’ï¼‰
â”‚   â””â”€â”€ utils.py             # Agent å·¥å…·å‡½æ•°
â”œâ”€â”€ tools/               # LangChain Tools
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py          # å·¥å…·åŸºç±»
â”‚   â”œâ”€â”€ code_tool.py     # ä»£ç ç›¸å…³å·¥å…·
â”‚   â”œâ”€â”€ log_tool.py      # æ—¥å¿—æŸ¥è¯¢å·¥å…·
â”‚   â”œâ”€â”€ database_tool.py # æ•°æ®åº“æŸ¥è¯¢å·¥å…·
â”‚   â””â”€â”€ registry.py      # å·¥å…·æ³¨å†Œè¡¨
â”œâ”€â”€ api/                 # API è·¯ç”±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ routes.py        # API è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ models.py        # API æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ middleware.py    # ä¸­é—´ä»¶
â”‚   â””â”€â”€ sse.py           # SSE äº‹ä»¶æµå¤„ç†
â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ cache.py          # ç¼“å­˜å·¥å…·
    â”œâ”€â”€ database.py       # æ•°æ®åº“å·¥å…·
    â”œâ”€â”€ extractors.py     # æ•°æ®æå–å™¨
    â”œâ”€â”€ logger.py         # æ—¥å¿—å·¥å…·
    â”œâ”€â”€ log_query.py      # æ—¥å¿—æŸ¥è¯¢å·¥å…·
    â””â”€â”€ metrics.py        # æŒ‡æ ‡æ”¶é›†
```

## æ–‡æ¡£

- [API æ–‡æ¡£](docs/API.md) - å®Œæ•´çš„ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- [ä½¿ç”¨æŒ‡å—](docs/USAGE.md) - å¿«é€Ÿå¼€å§‹å’Œä½¿ç”¨åœºæ™¯
- [é…ç½®è¯´æ˜](docs/CONFIG.md) - è¯¦ç»†çš„é…ç½®é€‰é¡¹è¯´æ˜
- [ç¤ºä¾‹åœºæ™¯](docs/EXAMPLES.md) - å¸¸è§é—®é¢˜åˆ†æåœºæ™¯ç¤ºä¾‹
- [Web UI å¯åŠ¨æŒ‡å—](docs/WEB_UI.md) - Web UI å¯åŠ¨å’Œä½¿ç”¨è¯´æ˜
- [å¼€å‘è€…æ‰©å±•æ–‡æ¡£](docs/DEVELOPMENT.md) - å¦‚ä½•æ‰©å±•åŠŸèƒ½å’Œæ·»åŠ æ–°å·¥å…·
- [SETUP.md](SETUP.md) - é¡¹ç›®è®¾ç½®æŒ‡å—
- [TESTING.md](TESTING.md) - æµ‹è¯•æŒ‡å—
- [DEPLOYMENT.md](DEPLOYMENT.md) - éƒ¨ç½²æŒ‡å—

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹ Swagger API æ–‡æ¡£ã€‚

## å¼€å‘

### ä»£ç æ ¼å¼åŒ–

```bash
black codebase_driven_agent tests
ruff check codebase_driven_agent tests
```

### ç±»å‹æ£€æŸ¥

```bash
mypy codebase_driven_agent
```

### è¿è¡Œæµ‹è¯•

#### åç«¯æµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
pip install -e ".[dev]"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_user_interaction.py

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»æˆ–å‡½æ•°
pytest tests/test_user_interaction.py::TestGraphExecutorUserInteraction
pytest tests/test_user_interaction.py::TestGraphExecutorUserInteraction::test_request_user_input_node

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest -v

# æ˜¾ç¤ºè¦†ç›–ç‡
pytest --cov=codebase_driven_agent --cov-report=html
```

#### å‰ç«¯æµ‹è¯•

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤º UIï¼ˆäº¤äº’å¼ï¼‰
npm run test:ui

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- UserInputRequest.test.tsx
```

#### è¿è¡Œç”¨æˆ·äº¤äº’åŠŸèƒ½æµ‹è¯•

```bash
# åç«¯ï¼šè¿è¡Œç”¨æˆ·äº¤äº’ç›¸å…³æµ‹è¯•
pytest tests/test_user_interaction.py -v

# å‰ç«¯ï¼šè¿è¡Œç”¨æˆ·äº¤äº’ç»„ä»¶æµ‹è¯•
cd web
npm test -- UserInputRequest UserReply UnifiedStepsBlock
```

## è®¸å¯è¯

MIT License

